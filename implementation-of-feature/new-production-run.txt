## 1. Production Run Lifecycle (State Machine)

This is non-negotiable if you want reliable analytics.

### States

1. **Planned**
2. **In Progress**
3. **Completed**
4. **Locked**

### Why this matters

- Expected values are calculated **only once** (at planning).
- Actual values are captured **only at completion**.
- Locked runs cannot be silently altered.

## 2. Step-by-Step System Flow (Aligned to Your Idea)

### Step 1: Create Production Run (Planned)

From the home page:

**Inputs**

- Machine ID
- Target quantity (finished goods)
- Planned start time
- Shift (morning / night)

**System Actions (Automatic)**

Using master data, the system calculates and stores:

### Expected Output

- Pieces per hour (from mould)
- Required production hours:

```
expected_hours = target_quantity / pieces_per_hour

```

### Expected Material

```
expected_raw_kg =
target_quantity × raw_material_per_piece

expected_masterbatch_kg =
expected_raw_kg × 0.02

```

### Expected Labour Cost

```
expected_labour_cost =
expected_hours × 2 operators × cost_per_hour

```

### Expected Material Cost

```
expected_material_cost =
(expected_raw_kg × raw_cost_per_kg) +
(expected_masterbatch_kg × mb_cost_per_kg)

```

> These values are stored as snapshots, not recalculated later.
> 

## 3. Start Production (In Progress)

When production starts:

- Status → **In Progress**
- Start time is locked
- No changes to expected values allowed

Optional (later phase):

- Live progress updates
- Downtime logging

## 4. Completed Production Run (Actuals Entry)

When production ends, admin enters **actual data received from operators**.

### Actual Inputs

- Actual start time
- Actual end time
- Actual pieces produced
- Actual raw material used (kg or bags)
- Actual masterbatch used (kg)
- Scrap quantity (optional)
- Downtime notes (optional)

### System Actions

- Calculate actual duration
- Calculate actual labour cost
- Deduct actual material from stock ledger
- Calculate variances

## 5. Expected vs Actual Comparison (Core Analytics)

For **each production run**, the system computes:

### Time Variance

```
actual_hours − expected_hours
```

### Output Efficiency

```
(actual_pieces / expected_pieces) ×100
```

### Material Variance

```
raw_variance_kg =
actual_raw_kg − expected_raw_kg
```

### Labour Cost Variance

```
actual_labour_cost − expected_labour_cost
```

### Total Cost Variance

```
(actual_material + actual_labour)
−
(expected_material + expected_labour)
```

These values are:

- Computed dynamically
- Read-only
- Fully auditable

## 6. Lock the Production Run

Once reviewed:

- Status → **Locked**
- No edits allowed without an explicit “Adjustment” record

This protects historical accuracy.

## 7. Stock Integration (Critical Alignment)

### When Stock Moves

- Stock is **not affected** at planning
- Stock is **deducted only at completion**, using actual values

### Stock Ledger Entry (Automatic)

For each material:

- Reference: production_run_id
- Quantity out = actual consumption
- Timestamp = completion time

This keeps finance, production, and inventory consistent.

## 8. Analytics View (Per Production Cycle)

Each production cycle page should show **four panels**:

1. **Plan vs Actual Summary**
2. **Material Efficiency**
3. **Labour Efficiency**
4. **Cost Breakdown**







